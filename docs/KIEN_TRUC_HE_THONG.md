# KIẾN TRÚC HỆ THỐNG TASKFLOW

## Mô hình 3-Tier kết hợp MVC (Model-View-Controller)

---

## 1. TỔNG QUAN KIẾN TRÚC

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                         │
│                                    KIẾN TRÚC 3-TIER + MVC - HỆ THỐNG TASKFLOW                                          │
│                                                                                                                         │
│  ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                                                                                                   │  │
│  │                                         TIER 1: PRESENTATION LAYER                                                │  │
│  │                                              (Client Side)                                                        │  │
│  │                                                                                                                   │  │
│  │    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                   │  │
│  │    │             │    │             │    │             │    │             │    │             │                   │  │
│  │    │   Desktop   │    │   Laptop    │    │   Tablet    │    │   Mobile    │    │   Other     │                   │  │
│  │    │   Browser   │    │   Browser   │    │   Browser   │    │   Browser   │    │   Clients   │                   │  │
│  │    │             │    │             │    │             │    │             │    │             │                   │  │
│  │    └──────┬──────┘    └──────┬──────┘    └──────┬──────┘    └──────┬──────┘    └──────┬──────┘                   │  │
│  │           │                  │                  │                  │                  │                          │  │
│  │           └──────────────────┴──────────────────┴──────────────────┴──────────────────┘                          │  │
│  │                                                 │                                                                 │  │
│  │                              ┌──────────────────┴──────────────────┐                                              │  │
│  │                              │                                     │                                              │  │
│  │                              │     HTML5 + CSS3 + JavaScript       │                                              │  │
│  │                              │                                     │                                              │  │
│  │                              │  ┌─────────────┐  ┌─────────────┐   │                                              │  │
│  │                              │  │ Tailwind CSS│  │  Alpine.js  │   │                                              │  │
│  │                              │  │ (Styling)   │  │ (Reactive)  │   │                                              │  │
│  │                              │  └─────────────┘  └─────────────┘   │                                              │  │
│  │                              │                                     │                                              │  │
│  │                              │  ┌─────────────┐  ┌─────────────┐   │                                              │  │
│  │                              │  │Lucide Icons │  │  Fetch API  │   │                                              │  │
│  │                              │  │ (Icons)     │  │ (AJAX)      │   │                                              │  │
│  │                              │  └─────────────┘  └─────────────┘   │                                              │  │
│  │                              │                                     │                                              │  │
│  │                              └──────────────────┬──────────────────┘                                              │  │
│  │                                                 │                                                                 │  │
│  └─────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────┘  │
│                                                    │                                                                    │
│                                                    │ HTTP/HTTPS Request                                                 │
│                                                    │ (GET, POST, PUT, DELETE)                                           │
│                                                    ▼                                                                    │
│  ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                                                                                                   │  │
│  │                                         TIER 2: APPLICATION LAYER                                                 │  │
│  │                                           (Server Side - PHP 8.x)                                                 │  │
│  │                                                                                                                   │  │
│  │    ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │  │
│  │    │                                        WEB SERVER (Apache/Nginx)                                        │   │  │
│  │    │                                                                                                         │   │  │
│  │    │    ┌─────────────────┐                                                                                  │   │  │
│  │    │    │   bootstrap.php │ ◄──── Entry Point: Khởi tạo autoload, config, session                           │   │  │
│  │    │    └────────┬────────┘                                                                                  │   │  │
│  │    │             │                                                                                           │   │  │
│  │    │             ▼                                                                                           │   │  │
│  │    │    ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐  │   │  │
│  │    │    │                                    MVC ARCHITECTURE                                             │  │   │  │
│  │    │    │                                                                                                 │  │   │  │
│  │    │    │  ┌─────────────────────────────────────────────────────────────────────────────────────────┐   │  │   │  │
│  │    │    │  │                              MIDDLEWARE LAYER                                           │   │  │   │  │
│  │    │    │  │                                                                                         │   │  │   │  │
│  │    │    │  │   ┌─────────────────────┐              ┌─────────────────────┐                          │   │  │   │  │
│  │    │    │  │   │  AuthMiddleware.php │              │PermissionMiddleware │                          │   │  │   │  │
│  │    │    │  │   │                     │              │        .php         │                          │   │  │   │  │
│  │    │    │  │   │ • Check session     │              │ • Check role        │                          │   │  │   │  │
│  │    │    │  │   │ • Verify login      │              │ • Verify permission │                          │   │  │   │  │
│  │    │    │  │   │ • Redirect if not   │              │ • RBAC validation   │                          │   │  │   │  │
│  │    │    │  │   └─────────────────────┘              └─────────────────────┘                          │   │  │   │  │
│  │    │    │  │                                                                                         │   │  │   │  │
│  │    │    │  └─────────────────────────────────────────────────────────────────────────────────────────┘   │  │   │  │
│  │    │    │                                           │                                                    │  │   │  │
│  │    │    │                                           ▼                                                    │  │   │  │
│  │    │    │  ┌─────────────────────────────────────────────────────────────────────────────────────────┐   │  │   │  │
│  │    │    │  │                                  CONTROLLER LAYER                                       │   │  │   │  │
│  │    │    │  │                                                                                         │   │  │   │  │
│  │    │    │  │   ┌───────────────┐  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐            │   │  │   │  │
│  │    │    │  │   │BaseController │  │AuthController │  │ProjectController│ │TaskController │            │   │  │   │  │
│  │    │    │  │   └───────┬───────┘  └───────────────┘  └───────────────┘  └───────────────┘            │   │  │   │  │
│  │    │    │  │           │                                                                             │   │  │   │  │
│  │    │    │  │           │          ┌───────────────┐  ┌───────────────┐  ┌───────────────┐            │   │  │   │  │
│  │    │    │  │           │          │DocumentController│ │CalendarController│ │AdminController│           │   │  │   │  │
│  │    │    │  │           │          └───────────────┘  └───────────────┘  └───────────────┘            │   │  │   │  │
│  │    │    │  │           │                                                                             │   │  │   │  │
│  │    │    │  │           ▼                                                                             │   │  │   │  │
│  │    │    │  │   • Nhận request từ client                                                              │   │  │   │  │
│  │    │    │  │   • Validate input data                                                                 │   │  │   │  │
│  │    │    │  │   • Gọi Model để xử lý business logic                                                   │   │  │   │  │
│  │    │    │  │   • Chọn View để render response                                                        │   │  │   │  │
│  │    │    │  │                                                                                         │   │  │   │  │
│  │    │    │  └─────────────────────────────────────────────────────────────────────────────────────────┘   │  │   │  │
│  │    │    │                          │                                     │                               │  │   │  │
│  │    │    │                          │                                     │                               │  │   │  │
│  │    │    │                          ▼                                     ▼                               │  │   │  │
│  │    │    │  ┌─────────────────────────────────────┐   ┌─────────────────────────────────────┐             │  │   │  │
│  │    │    │  │           MODEL LAYER               │   │           VIEW LAYER                │             │  │   │  │
│  │    │    │  │                                     │   │                                     │             │  │   │  │
│  │    │    │  │  ┌───────────────┐                  │   │  ┌───────────────┐                  │             │  │   │  │
│  │    │    │  │  │  BaseModel    │                  │   │  │   Layouts     │                  │             │  │   │  │
│  │    │    │  │  └───────┬───────┘                  │   │  │  • main.php   │                  │             │  │   │  │
│  │    │    │  │          │                          │   │  │  • admin.php  │                  │             │  │   │  │
│  │    │    │  │  ┌───────┴───────┐                  │   │  │  • guest.php  │                  │             │  │   │  │
│  │    │    │  │  │               │                  │   │  └───────────────┘                  │             │  │   │  │
│  │    │    │  │  ▼               ▼                  │   │                                     │             │  │   │  │
│  │    │    │  │ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐    │   │  ┌───────────────┐                  │             │  │   │  │
│  │    │    │  │ │User │ │Proj.│ │Task │ │Doc. │    │   │  │  Components   │                  │             │  │   │  │
│  │    │    │  │ └─────┘ └─────┘ └─────┘ └─────┘    │   │  │  • header.php │                  │             │  │   │  │
│  │    │    │  │                                     │   │  │  • sidebar.php│                  │             │  │   │  │
│  │    │    │  │  • Business logic                   │   │  │  • modal.php  │                  │             │  │   │  │
│  │    │    │  │  • Data validation                  │   │  └───────────────┘                  │             │  │   │  │
│  │    │    │  │  • Database operations              │   │                                     │             │  │   │  │
│  │    │    │  │                                     │   │  ┌───────────────┐                  │             │  │   │  │
│  │    │    │  └──────────────────┬──────────────────┘   │  │    Pages      │                  │             │  │   │  │
│  │    │    │                     │                      │  │  • dashboard/ │                  │             │  │   │  │
│  │    │    │                     │                      │  │  • projects/  │                  │             │  │   │  │
│  │    │    │                     │                      │  │  • tasks/     │                  │             │  │   │  │
│  │    │    │                     │                      │  │  • admin/     │                  │             │  │   │  │
│  │    │    │                     │                      │  └───────────────┘                  │             │  │   │  │
│  │    │    │                     │                      │                                     │             │  │   │  │
│  │    │    │                     │                      └─────────────────────────────────────┘             │  │   │  │
│  │    │    │                     │                                                                          │  │   │  │
│  │    │    └─────────────────────┼──────────────────────────────────────────────────────────────────────────┘  │   │  │
│  │    │                          │                                                                             │   │  │
│  │    │    ┌─────────────────────┴──────────────────┐                                                          │   │  │
│  │    │    │              CORE FRAMEWORK            │                                                          │   │  │
│  │    │    │                                        │                                                          │   │  │
│  │    │    │  ┌──────────┐ ┌──────────┐ ┌────────┐  │                                                          │   │  │
│  │    │    │  │Database  │ │ Session  │ │  View  │  │                                                          │   │  │
│  │    │    │  │(Singleton)│ │          │ │        │  │                                                          │   │  │
│  │    │    │  └──────────┘ └──────────┘ └────────┘  │                                                          │   │  │
│  │    │    │                                        │                                                          │   │  │
│  │    │    │  ┌──────────┐ ┌──────────┐ ┌────────┐  │                                                          │   │  │
│  │    │    │  │Permission│ │Validator │ │ Logger │  │                                                          │   │  │
│  │    │    │  │  (RBAC)  │ │          │ │        │  │                                                          │   │  │
│  │    │    │  └──────────┘ └──────────┘ └────────┘  │                                                          │   │  │
│  │    │    │                                        │                                                          │   │  │
│  │    │    │  ┌──────────┐                          │                                                          │   │  │
│  │    │    │  │RateLimiter│                         │                                                          │   │  │
│  │    │    │  └──────────┘                          │                                                          │   │  │
│  │    │    │                                        │                                                          │   │  │
│  │    │    └────────────────────────────────────────┘                                                          │   │  │
│  │    │                                                                                                         │   │  │
│  │    └─────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                                                                   │  │
│  └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                    │                                                                    │
│                                                    │ SQL Queries (PDO)                                                  │
│                                                    │ Prepared Statements                                                │
│                                                    ▼                                                                    │
│  ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                                                                                                   │  │
│  │                                          TIER 3: DATA LAYER                                                       │  │
│  │                                           (MySQL 8.0 Database)                                                    │  │
│  │                                                                                                                   │  │
│  │    ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │  │
│  │    │                                         MySQL 8.0 Server                                                │   │  │
│  │    │                                                                                                         │   │  │
│  │    │    ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐  │   │  │
│  │    │    │                                    DATABASE: taskflow                                           │  │   │  │
│  │    │    │                                                                                                 │  │   │  │
│  │    │    │  ┌─────────────────────────────────────────────────────────────────────────────────────────┐   │  │   │  │
│  │    │    │  │                                   16 TABLES                                             │   │  │   │  │
│  │    │    │  │                                                                                         │   │  │   │  │
│  │    │    │  │   ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐              │   │  │   │  │
│  │    │    │  │   │  users  │ │projects │ │  tasks  │ │documents│ │comments │ │ labels  │              │   │  │   │  │
│  │    │    │  │   └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘              │   │  │   │  │
│  │    │    │  │                                                                                         │   │  │   │  │
│  │    │    │  │   ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐              │   │  │   │  │
│  │    │    │  │   │project_ │ │task_    │ │task_    │ │task_    │ │document_│ │calendar_│              │   │  │   │  │
│  │    │    │  │   │members  │ │assignees│ │checklists│ │labels   │ │shares   │ │events   │              │   │  │   │  │
│  │    │    │  │   └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘              │   │  │   │  │
│  │    │    │  │                                                                                         │   │  │   │  │
│  │    │    │  │   ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐                                       │   │  │   │  │
│  │    │    │  │   │event_   │ │notifica-│ │activity_│ │user_    │                                       │   │  │   │  │
│  │    │    │  │   │attendees│ │tions    │ │logs     │ │settings │                                       │   │  │   │  │
│  │    │    │  │   └─────────┘ └─────────┘ └─────────┘ └─────────┘                                       │   │  │   │  │
│  │    │    │  │                                                                                         │   │  │   │  │
│  │    │    │  └─────────────────────────────────────────────────────────────────────────────────────────┘   │  │   │  │
│  │    │    │                                                                                                 │  │   │  │
│  │    │    │  ┌─────────────────────────────────────────────────────────────────────────────────────────┐   │  │   │  │
│  │    │    │  │                              DATABASE FEATURES                                          │   │  │   │  │
│  │    │    │  │                                                                                         │   │  │   │  │
│  │    │    │  │   • UUID Primary Keys          • Foreign Key Constraints                                │   │  │   │  │
│  │    │    │  │   • Indexes for Performance    • ON DELETE CASCADE/SET NULL                             │   │  │   │  │
│  │    │    │  │   • ENUM for Status/Role       • JSON columns for flexible data                         │   │  │   │  │
│  │    │    │  │   • UTF8MB4 Character Set      • InnoDB Engine                                          │   │  │   │  │
│  │    │    │  │                                                                                         │   │  │   │  │
│  │    │    │  └─────────────────────────────────────────────────────────────────────────────────────────┘   │  │   │  │
│  │    │    │                                                                                                 │  │   │  │
│  │    │    └─────────────────────────────────────────────────────────────────────────────────────────────────┘  │   │  │
│  │    │                                                                                                         │   │  │
│  │    │    ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐  │   │  │
│  │    │    │                                      FILE STORAGE                                              │  │   │  │
│  │    │    │                                                                                                 │  │   │  │
│  │    │    │   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                     │  │   │  │
│  │    │    │   │  uploads/   │    │  storage/   │    │   logs/     │    │   config/   │                     │  │   │  │
│  │    │    │   │  avatars/   │    │   cache/    │    │  app logs   │    │  app.php    │                     │  │   │  │
│  │    │    │   │  documents/ │    │rate_limits/ │    │             │    │database.php │                     │  │   │  │
│  │    │    │   └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘                     │  │   │  │
│  │    │    │                                                                                                 │  │   │  │
│  │    │    └─────────────────────────────────────────────────────────────────────────────────────────────────┘  │   │  │
│  │    │                                                                                                         │   │  │
│  │    └─────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                                                                   │  │
│  └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```



---

## 2. SƠ ĐỒ LUỒNG XỬ LÝ REQUEST (REQUEST FLOW)

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                           REQUEST FLOW DIAGRAM                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

                                    ┌─────────────────────────────────────┐
                                    │           USER/BROWSER              │
                                    │                                     │
                                    │  Click button / Submit form / AJAX  │
                                    └──────────────────┬──────────────────┘
                                                       │
                                                       │ HTTP Request
                                                       │ (GET/POST/PUT/DELETE)
                                                       ▼
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                              TIER 1: PRESENTATION                                                        │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                                                                                                    │  │
│  │   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │  │
│  │   │                                    FRONTEND TECHNOLOGIES                                                    │ │  │
│  │   │                                                                                                             │ │  │
│  │   │   ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐                 │ │  │
│  │   │   │   HTML5 Pages   │    │  Tailwind CSS   │    │   Alpine.js     │    │   Fetch API     │                 │ │  │
│  │   │   │                 │    │                 │    │                 │    │                 │                 │ │  │
│  │   │   │ • Semantic tags │    │ • Utility-first │    │ • x-data        │    │ • async/await   │                 │ │  │
│  │   │   │ • Forms         │    │ • Responsive    │    │ • x-show        │    │ • JSON payload  │                 │ │  │
│  │   │   │ • Tables        │    │ • Dark mode     │    │ • @click        │    │ • Error handling│                 │ │  │
│  │   │   │ • Modals        │    │ • Animations    │    │ • x-for         │    │ • CSRF token    │                 │ │  │
│  │   │   └─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘                 │ │  │
│  │   │                                                                                                             │ │  │
│  │   └─────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                                                                    │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                       │
                                                       │ HTTP/HTTPS
                                                       ▼
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                              TIER 2: APPLICATION (PHP 8.x)                                               │
│                                                                                                                          │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │  STEP 1: ENTRY POINT                                                                                               │  │
│  │  ┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │  │
│  │  │                                                                                                              │  │  │
│  │  │   index.php / tasks.php / projects.php / api/*.php                                                           │  │  │
│  │  │                                                                                                              │  │  │
│  │  │   <?php                                                                                                      │  │  │
│  │  │   require_once 'bootstrap.php';  // Load autoloader, config, session                                         │  │  │
│  │  │                                                                                                              │  │  │
│  │  └──────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                       │                                                                  │
│                                                       ▼                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │  STEP 2: BOOTSTRAP                                                                                                 │  │
│  │  ┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │  │
│  │  │                                                                                                              │  │  │
│  │  │   bootstrap.php                                                                                              │  │  │
│  │  │   ├── Define BASE_PATH constant                                                                              │  │  │
│  │  │   ├── Register spl_autoload_register()                                                                       │  │  │
│  │  │   ├── Load config/app.php                                                                                    │  │  │
│  │  │   ├── Initialize Core\Session                                                                                │  │  │
│  │  │   ├── Set error handlers                                                                                     │  │  │
│  │  │   └── Initialize Core\Database (Singleton)                                                                   │  │  │
│  │  │                                                                                                              │  │  │
│  │  └──────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                       │                                                                  │
│                                                       ▼                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │  STEP 3: MIDDLEWARE                                                                                                │  │
│  │  ┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │  │
│  │  │                                                                                                              │  │  │
│  │  │   ┌─────────────────────────────────┐         ┌─────────────────────────────────┐                            │  │  │
│  │  │   │      AuthMiddleware.php         │         │    PermissionMiddleware.php     │                            │  │  │
│  │  │   │                                 │         │                                 │                            │  │  │
│  │  │   │  • Check Session::has('user_id')│  ───►   │  • Check user role              │                            │  │  │
│  │  │   │  • Redirect to /login if not    │         │  • Verify permission for action │                            │  │  │
│  │  │   │  • Return 401 for API requests  │         │  • Return 403 if denied         │                            │  │  │
│  │  │   │                                 │         │                                 │                            │  │  │
│  │  │   └─────────────────────────────────┘         └─────────────────────────────────┘                            │  │  │
│  │  │                                                                                                              │  │  │
│  │  └──────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                       │                                                                  │
│                                                       ▼                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │  STEP 4: CONTROLLER (MVC - C)                                                                                      │  │
│  │  ┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │  │
│  │  │                                                                                                              │  │  │
│  │  │   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐   │  │  │
│  │  │   │                                    BaseController                                                   │   │  │  │
│  │  │   │                                                                                                     │   │  │  │
│  │  │   │   # view(string $view, array $data)     - Render view với data                                      │   │  │  │
│  │  │   │   # json(array $data, int $status)      - Return JSON response                                      │   │  │  │
│  │  │   │   # redirect(string $url)               - Redirect to URL                                           │   │  │  │
│  │  │   │   # userId()                            - Get current user ID                                       │   │  │  │
│  │  │   │   # user()                              - Get current user data                                     │   │  │  │
│  │  │   │   # input(string $key)                  - Get sanitized input                                       │   │  │  │
│  │  │   │   # validate(array $rules)              - Validate input data                                       │   │  │  │
│  │  │   │                                                                                                     │   │  │  │
│  │  │   └─────────────────────────────────────────────────────────────────────────────────────────────────────┘   │  │  │
│  │  │                                              │                                                              │  │  │
│  │  │                                              │ extends                                                      │  │  │
│  │  │                                              ▼                                                              │  │  │
│  │  │   ┌───────────────┐ ┌───────────────┐ ┌───────────────┐ ┌───────────────┐ ┌───────────────┐                │  │  │
│  │  │   │AuthController │ │DashboardCtrl  │ │ProjectCtrl    │ │TaskController │ │DocumentCtrl   │                │  │  │
│  │  │   │               │ │               │ │               │ │               │ │               │                │  │  │
│  │  │   │• login()      │ │• index()      │ │• index()      │ │• index()      │ │• index()      │                │  │  │
│  │  │   │• register()   │ │• stats()      │ │• show()       │ │• show()       │ │• upload()     │                │  │  │
│  │  │   │• logout()     │ │               │ │• create()     │ │• create()     │ │• download()   │                │  │  │
│  │  │   │• forgotPwd()  │ │               │ │• update()     │ │• update()     │ │• delete()     │                │  │  │
│  │  │   └───────────────┘ └───────────────┘ └───────────────┘ └───────────────┘ └───────────────┘                │  │  │
│  │  │                                                                                                              │  │  │
│  │  │   ┌───────────────┐ ┌───────────────┐ ┌───────────────┐ ┌───────────────┐ ┌───────────────┐                │  │  │
│  │  │   │CalendarCtrl   │ │NotificationCtrl│ │ReportsCtrl   │ │SettingsCtrl   │ │AdminController│                │  │  │
│  │  │   │               │ │               │ │               │ │               │ │               │                │  │  │
│  │  │   │• index()      │ │• index()      │ │• index()      │ │• index()      │ │• dashboard()  │                │  │  │
│  │  │   │• create()     │ │• markRead()   │ │• generate()   │ │• update()     │ │• users()      │                │  │  │
│  │  │   │• update()     │ │• markAllRead()│ │• export()     │ │• password()   │ │• projects()   │                │  │  │
│  │  │   │• delete()     │ │               │ │               │ │               │ │• settings()   │                │  │  │
│  │  │   └───────────────┘ └───────────────┘ └───────────────┘ └───────────────┘ └───────────────┘                │  │  │
│  │  │                                                                                                              │  │  │
│  │  └──────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                       │                                                                  │
│                                                       ▼                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │  STEP 5: MODEL (MVC - M)                                                                                           │  │
│  │  ┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │  │
│  │  │                                                                                                              │  │  │
│  │  │   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐   │  │  │
│  │  │   │                                      BaseModel                                                      │   │  │  │
│  │  │   │                                                                                                     │   │  │  │
│  │  │   │   # $db: Database                       - Database instance (Singleton)                             │   │  │  │
│  │  │   │   # $table: string                      - Table name                                                │   │  │  │
│  │  │   │   # $primaryKey: string = 'id'          - Primary key column                                        │   │  │  │
│  │  │   │                                                                                                     │   │  │  │
│  │  │   │   + find(string $id): ?array            - Find by ID                                                │   │  │  │
│  │  │   │   + findAll(): array                    - Get all records                                           │   │  │  │
│  │  │   │   + create(array $data): string         - Insert new record                                         │   │  │  │
│  │  │   │   + update(string $id, array $data)     - Update record                                             │   │  │  │
│  │  │   │   + delete(string $id): bool            - Delete record                                             │   │  │  │
│  │  │   │   + where(array $conditions): array     - Find by conditions                                        │   │  │  │
│  │  │   │                                                                                                     │   │  │  │
│  │  │   └─────────────────────────────────────────────────────────────────────────────────────────────────────┘   │  │  │
│  │  │                                              │                                                              │  │  │
│  │  │                                              │ extends                                                      │  │  │
│  │  │                                              ▼                                                              │  │  │
│  │  │   ┌───────────────┐ ┌───────────────┐ ┌───────────────┐ ┌───────────────┐ ┌───────────────┐                │  │  │
│  │  │   │  User Model   │ │ Project Model │ │  Task Model   │ │Document Model │ │CalendarEvent  │                │  │  │
│  │  │   │               │ │               │ │               │ │               │ │    Model      │                │  │  │
│  │  │   │• authenticate │ │• getByUser()  │ │• getByUser()  │ │• getByProject │ │• getByUser()  │                │  │  │
│  │  │   │• findByEmail  │ │• getMembers() │ │• getByProject │ │• getByFolder  │ │• getByDate()  │                │  │  │
│  │  │   │• updatePwd    │ │• addMember()  │ │• getAssignees │ │• upload()     │ │• getAttendees │                │  │  │
│  │  │   │• getSettings  │ │• getStats()   │ │• getChecklist │ │• share()      │ │• addAttendee  │                │  │  │
│  │  │   └───────────────┘ └───────────────┘ └───────────────┘ └───────────────┘ └───────────────┘                │  │  │
│  │  │                                                                                                              │  │  │
│  │  └──────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                       │                                                                  │
│                                                       │ SQL Queries via PDO                                              │
│                                                       ▼                                                                  │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                       │
                                                       ▼
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                              TIER 3: DATA LAYER (MySQL 8.0)                                              │
│                                                                                                                          │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                                                                                                    │  │
│  │   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │  │
│  │   │                                    DATABASE: taskflow                                                       │ │  │
│  │   │                                                                                                             │ │  │
│  │   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐  │ │  │
│  │   │   │                                    CORE TABLES                                                      │  │ │  │
│  │   │   │                                                                                                     │  │ │  │
│  │   │   │   users ◄────────────────┐                                                                          │  │ │  │
│  │   │   │   ├── id (UUID, PK)      │                                                                          │  │ │  │
│  │   │   │   ├── email              │                                                                          │  │ │  │
│  │   │   │   ├── password (bcrypt)  │                                                                          │  │ │  │
│  │   │   │   ├── full_name          │                                                                          │  │ │  │
│  │   │   │   ├── role (ENUM)        │                                                                          │  │ │  │
│  │   │   │   └── status             │                                                                          │  │ │  │
│  │   │   │                          │                                                                          │  │ │  │
│  │   │   │   projects ◄─────────────┼──────────────────┐                                                       │  │ │  │
│  │   │   │   ├── id (UUID, PK)      │                  │                                                       │  │ │  │
│  │   │   │   ├── name               │                  │                                                       │  │ │  │
│  │   │   │   ├── description        │                  │                                                       │  │ │  │
│  │   │   │   ├── status             │                  │                                                       │  │ │  │
│  │   │   │   ├── created_by (FK) ───┘                  │                                                       │  │ │  │
│  │   │   │   └── owner_id (FK) ─────┘                  │                                                       │  │ │  │
│  │   │   │                                             │                                                       │  │ │  │
│  │   │   │   tasks ◄───────────────────────────────────┼──────────────────┐                                    │  │ │  │
│  │   │   │   ├── id (UUID, PK)                         │                  │                                    │  │ │  │
│  │   │   │   ├── title                                 │                  │                                    │  │ │  │
│  │   │   │   ├── description                           │                  │                                    │  │ │  │
│  │   │   │   ├── status (ENUM)                         │                  │                                    │  │ │  │
│  │   │   │   ├── priority (ENUM)                       │                  │                                    │  │ │  │
│  │   │   │   ├── project_id (FK) ──────────────────────┘                  │                                    │  │ │  │
│  │   │   │   └── created_by (FK) ─────────────────────────────────────────┘                                    │  │ │  │
│  │   │   │                                                                                                     │  │ │  │
│  │   │   └─────────────────────────────────────────────────────────────────────────────────────────────────────┘  │ │  │
│  │   │                                                                                                             │ │  │
│  │   └─────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                                                                    │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                       │
                                                       │ Query Result
                                                       ▼
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                              RESPONSE FLOW (Ngược lại)                                                   │
│                                                                                                                          │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │  STEP 6: VIEW (MVC - V)                                                                                            │  │
│  │  ┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │  │
│  │  │                                                                                                              │  │  │
│  │  │   Controller gọi: $this->view('tasks/index', ['tasks' => $tasks, 'projects' => $projects])                   │  │  │
│  │  │                                                                                                              │  │  │
│  │  │   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐   │  │  │
│  │  │   │                                    Core\View::render()                                              │   │  │  │
│  │  │   │                                                                                                     │   │  │  │
│  │  │   │   1. extract($data) → Biến $tasks, $projects có thể dùng trong view                                 │   │  │  │
│  │  │   │   2. ob_start() → Bắt đầu output buffering                                                          │   │  │  │
│  │  │   │   3. include 'app/views/tasks/index.php' → Render content                                           │   │  │  │
│  │  │   │   4. $content = ob_get_clean() → Lấy content                                                        │   │  │  │
│  │  │   │   5. include 'app/views/layouts/main.php' → Wrap trong layout                                       │   │  │  │
│  │  │   │                                                                                                     │   │  │  │
│  │  │   └─────────────────────────────────────────────────────────────────────────────────────────────────────┘   │  │  │
│  │  │                                                                                                              │  │  │
│  │  │   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐   │  │  │
│  │  │   │                                    VIEW STRUCTURE                                                   │   │  │  │
│  │  │   │                                                                                                     │   │  │  │
│  │  │   │   app/views/                                                                                        │   │  │  │
│  │  │   │   ├── layouts/                                                                                      │   │  │  │
│  │  │   │   │   ├── main.php          ← Layout chính cho user đã đăng nhập                                    │   │  │  │
│  │  │   │   │   ├── admin.php         ← Layout cho admin panel                                                │   │  │  │
│  │  │   │   │   └── guest.php         ← Layout cho trang login/register                                       │   │  │  │
│  │  │   │   │                                                                                                 │   │  │  │
│  │  │   │   ├── components/                                                                                   │   │  │  │
│  │  │   │   │   ├── header.php        ← Header với user menu, notifications                                   │   │  │  │
│  │  │   │   │   ├── sidebar.php       ← Sidebar navigation                                                    │   │  │  │
│  │  │   │   │   └── search-modal.php  ← Global search modal                                                   │   │  │  │
│  │  │   │   │                                                                                                 │   │  │  │
│  │  │   │   ├── dashboard/index.php                                                                           │   │  │  │
│  │  │   │   ├── projects/index.php, detail.php                                                                │   │  │  │
│  │  │   │   ├── tasks/index.php, detail.php                                                                   │   │  │  │
│  │  │   │   ├── documents/index.php                                                                           │   │  │  │
│  │  │   │   ├── calendar/index.php                                                                            │   │  │  │
│  │  │   │   ├── reports/index.php                                                                             │   │  │  │
│  │  │   │   ├── settings/index.php                                                                            │   │  │  │
│  │  │   │   └── admin/*.php                                                                                   │   │  │  │
│  │  │   │                                                                                                     │   │  │  │
│  │  │   └─────────────────────────────────────────────────────────────────────────────────────────────────────┘   │  │  │
│  │  │                                                                                                              │  │  │
│  │  └──────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                       │
                                                       │ HTML/JSON Response
                                                       ▼
                                    ┌─────────────────────────────────────┐
                                    │           USER/BROWSER              │
                                    │                                     │
                                    │   Render HTML / Process JSON        │
                                    └─────────────────────────────────────┘
```


---

## 3. SƠ ĐỒ CẤU TRÚC THƯ MỤC DỰ ÁN

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                           PROJECT DIRECTORY STRUCTURE                                                   │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

taskflow/
│
├── 📁 app/                                    ← APPLICATION LAYER (MVC)
│   │
│   ├── 📁 controllers/                        ← CONTROLLERS (C)
│   │   ├── BaseController.php                 ← Abstract base controller
│   │   ├── AuthController.php                 ← Login, Register, Logout
│   │   ├── DashboardController.php            ← Dashboard page
│   │   ├── ProjectController.php              ← Project CRUD
│   │   ├── TaskController.php                 ← Task CRUD
│   │   ├── DocumentController.php             ← Document management
│   │   ├── CalendarController.php             ← Calendar events
│   │   ├── NotificationController.php         ← Notifications
│   │   ├── ReportsController.php              ← Reports generation
│   │   ├── SettingsController.php             ← User settings
│   │   ├── TeamController.php                 ← Team management
│   │   ├── ManagerController.php              ← Manager features
│   │   └── AdminController.php                ← Admin panel
│   │
│   ├── 📁 models/                             ← MODELS (M)
│   │   ├── BaseModel.php                      ← Abstract base model
│   │   ├── User.php                           ← User model
│   │   ├── Project.php                        ← Project model
│   │   ├── Task.php                           ← Task model
│   │   ├── Document.php                       ← Document model
│   │   └── CalendarEvent.php                  ← Calendar event model
│   │
│   ├── 📁 views/                              ← VIEWS (V)
│   │   ├── 📁 layouts/                        ← Layout templates
│   │   │   ├── main.php                       ← Main layout (authenticated)
│   │   │   ├── admin.php                      ← Admin layout
│   │   │   └── guest.php                      ← Guest layout (login/register)
│   │   │
│   │   ├── 📁 components/                     ← Reusable components
│   │   │   ├── header.php
│   │   │   ├── sidebar.php
│   │   │   └── search-modal.php
│   │   │
│   │   ├── 📁 auth/                           ← Auth views
│   │   │   ├── login.php
│   │   │   └── register.php
│   │   │
│   │   ├── 📁 dashboard/                      ← Dashboard views
│   │   │   └── index.php
│   │   │
│   │   ├── 📁 projects/                       ← Project views
│   │   │   ├── index.php
│   │   │   └── detail.php
│   │   │
│   │   ├── 📁 tasks/                          ← Task views
│   │   │   ├── index.php
│   │   │   └── detail.php
│   │   │
│   │   ├── 📁 documents/                      ← Document views
│   │   │   └── index.php
│   │   │
│   │   ├── 📁 calendar/                       ← Calendar views
│   │   │   └── index.php
│   │   │
│   │   ├── 📁 reports/                        ← Report views
│   │   │   └── index.php
│   │   │
│   │   ├── 📁 settings/                       ← Settings views
│   │   │   └── index.php
│   │   │
│   │   └── 📁 admin/                          ← Admin views
│   │       ├── dashboard.php
│   │       ├── users.php
│   │       ├── projects.php
│   │       ├── tasks.php
│   │       ├── documents.php
│   │       ├── reports.php
│   │       ├── logs.php
│   │       ├── backup.php
│   │       └── settings.php
│   │
│   └── 📁 middleware/                         ← MIDDLEWARE
│       ├── AuthMiddleware.php                 ← Authentication check
│       └── PermissionMiddleware.php           ← Permission/RBAC check
│
├── 📁 core/                                   ← CORE FRAMEWORK
│   ├── Database.php                           ← Database singleton (PDO)
│   ├── Session.php                            ← Session management
│   ├── View.php                               ← View rendering engine
│   ├── Permission.php                         ← RBAC permission system
│   ├── Validator.php                          ← Input validation
│   ├── Logger.php                             ← Logging system
│   └── RateLimiter.php                        ← Rate limiting
│
├── 📁 config/                                 ← CONFIGURATION
│   ├── app.php                                ← Application config
│   └── permissions.php                        ← Permission definitions
│
├── 📁 api/                                    ← API ENDPOINTS (REST)
│   ├── create-project.php
│   ├── update-project.php
│   ├── create-task.php
│   ├── update-task.php
│   ├── upload-document.php
│   ├── calendar.php
│   ├── notifications.php
│   ├── comments.php
│   ├── checklist.php
│   ├── search.php
│   └── admin-*.php                            ← Admin API endpoints
│
├── 📁 database/                               ← DATABASE
│   ├── taskflow2.sql                          ← Main schema
│   ├── seed.sql                               ← Seed data
│   └── migrate-*.php                          ← Migration scripts
│
├── 📁 public/                                 ← PUBLIC ASSETS
│   └── 📁 assets/
│       ├── 📁 css/
│       ├── 📁 js/
│       └── 📁 images/
│
├── 📁 uploads/                                ← FILE UPLOADS
│   ├── 📁 avatars/
│   └── 📁 documents/
│
├── 📁 storage/                                ← STORAGE
│   ├── 📁 cache/
│   └── 📁 rate_limits/
│
├── 📁 logs/                                   ← LOG FILES
│   └── app.log
│
├── 📁 docs/                                   ← DOCUMENTATION
│   ├── KIEN_TRUC_HE_THONG.md
│   ├── PHAN_QUYEN.md
│   └── HUONG_DAN_CAI_DAT.md
│
├── bootstrap.php                              ← BOOTSTRAP FILE
├── index.php                                  ← Entry point (Dashboard)
├── login.php                                  ← Login page
├── register.php                               ← Register page
├── projects.php                               ← Projects page
├── tasks.php                                  ← Tasks page
├── documents.php                              ← Documents page
├── calendar.php                               ← Calendar page
├── reports.php                                ← Reports page
├── settings.php                               ← Settings page
├── notifications.php                          ← Notifications page
├── team.php                                   ← Team page
└── .env.example                               ← Environment config example
```


---

## 4. SƠ ĐỒ DATABASE (ERD - Entity Relationship Diagram)

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                           DATABASE SCHEMA - ERD                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                         │
│   ┌─────────────────────┐                                                                                               │
│   │       users         │                                                                                               │
│   ├─────────────────────┤                                                                                               │
│   │ PK id (UUID)        │◄─────────────────────────────────────────────────────────────────────────────────────────┐   │
│   │    email            │                                                                                          │   │
│   │    password         │                                                                                          │   │
│   │    full_name        │                                                                                          │   │
│   │    role (ENUM)      │    ┌─────────────────────┐                                                               │   │
│   │    status           │    │   user_settings     │                                                               │   │
│   │    avatar           │    ├─────────────────────┤                                                               │   │
│   │    created_at       │    │ PK id               │                                                               │   │
│   │    updated_at       │    │ FK user_id ─────────┼───────────────────────────────────────────────────────────────┤   │
│   └─────────────────────┘    │    theme            │                                                               │   │
│            │                 │    language         │                                                               │   │
│            │                 │    notifications    │                                                               │   │
│            │                 └─────────────────────┘                                                               │   │
│            │                                                                                                        │   │
│            │ 1:N                                                                                                    │   │
│            ▼                                                                                                        │   │
│   ┌─────────────────────┐         ┌─────────────────────┐                                                          │   │
│   │     projects        │         │   project_members   │                                                          │   │
│   ├─────────────────────┤         ├─────────────────────┤                                                          │   │
│   │ PK id (UUID)        │◄────────┤ FK project_id       │                                                          │   │
│   │    name             │         │ FK user_id ─────────┼──────────────────────────────────────────────────────────┤   │
│   │    description      │         │    role             │                                                          │   │
│   │    color            │         │    joined_at        │                                                          │   │
│   │    status           │         └─────────────────────┘                                                          │   │
│   │ FK created_by ──────┼──────────────────────────────────────────────────────────────────────────────────────────┤   │
│   │ FK owner_id ────────┼──────────────────────────────────────────────────────────────────────────────────────────┤   │
│   │    start_date       │                                                                                          │   │
│   │    end_date         │                                                                                          │   │
│   │    created_at       │                                                                                          │   │
│   └─────────────────────┘                                                                                          │   │
│            │                                                                                                        │   │
│            │ 1:N                                                                                                    │   │
│            ▼                                                                                                        │   │
│   ┌─────────────────────┐         ┌─────────────────────┐         ┌─────────────────────┐                          │   │
│   │       tasks         │         │   task_assignees    │         │   task_checklists   │                          │   │
│   ├─────────────────────┤         ├─────────────────────┤         ├─────────────────────┤                          │   │
│   │ PK id (UUID)        │◄────────┤ FK task_id          │         │ PK id               │                          │   │
│   │    title            │         │ FK user_id ─────────┼─────────┤ FK task_id          │                          │   │
│   │    description      │         │    assigned_at      │         │    title            │                          │   │
│   │    status (ENUM)    │         └─────────────────────┘         │    is_completed     │                          │   │
│   │    priority (ENUM)  │                                         │    position         │                          │   │
│   │ FK project_id ──────┼─────────────────────────────────────────┴─────────────────────┘                          │   │
│   │ FK created_by ──────┼──────────────────────────────────────────────────────────────────────────────────────────┤   │
│   │    due_date         │                                                                                          │   │
│   │    estimated_hours  │         ┌─────────────────────┐                                                          │   │
│   │    actual_hours     │         │    task_labels      │         ┌─────────────────────┐                          │   │
│   │    created_at       │         ├─────────────────────┤         │      labels         │                          │   │
│   └─────────────────────┘         │ FK task_id          │         ├─────────────────────┤                          │   │
│            │                      │ FK label_id ────────┼────────►│ PK id               │                          │   │
│            │                      └─────────────────────┘         │    name             │                          │   │
│            │                                                      │    color            │                          │   │
│            │                                                      │ FK project_id       │                          │   │
│            │                                                      └─────────────────────┘                          │   │
│            │                                                                                                        │   │
│            │                                                                                                        │   │
│            ▼                                                                                                        │   │
│   ┌─────────────────────┐                                                                                          │   │
│   │      comments       │                                                                                          │   │
│   ├─────────────────────┤                                                                                          │   │
│   │ PK id (UUID)        │                                                                                          │   │
│   │    entity_type      │  ← 'task', 'project', 'document'                                                         │   │
│   │    entity_id        │                                                                                          │   │
│   │    content          │                                                                                          │   │
│   │ FK created_by ──────┼──────────────────────────────────────────────────────────────────────────────────────────┤   │
│   │    created_at       │                                                                                          │   │
│   └─────────────────────┘                                                                                          │   │
│                                                                                                                     │   │
│                                                                                                                     │   │
│   ┌─────────────────────┐         ┌─────────────────────┐                                                          │   │
│   │     documents       │         │   document_shares   │                                                          │   │
│   ├─────────────────────┤         ├─────────────────────┤                                                          │   │
│   │ PK id (UUID)        │◄────────┤ FK document_id      │                                                          │   │
│   │    name             │         │ FK user_id ─────────┼──────────────────────────────────────────────────────────┤   │
│   │    file_path        │         │    permission       │                                                          │   │
│   │    file_size        │         └─────────────────────┘                                                          │   │
│   │    mime_type        │                                                                                          │   │
│   │    type (ENUM)      │  ← 'file', 'folder'                                                                      │   │
│   │ FK project_id       │                                                                                          │   │
│   │ FK parent_id        │  ← Self-reference for folders                                                            │   │
│   │ FK created_by ──────┼──────────────────────────────────────────────────────────────────────────────────────────┤   │
│   │    created_at       │                                                                                          │   │
│   └─────────────────────┘                                                                                          │   │
│                                                                                                                     │   │
│                                                                                                                     │   │
│   ┌─────────────────────┐         ┌─────────────────────┐                                                          │   │
│   │   calendar_events   │         │   event_attendees   │                                                          │   │
│   ├─────────────────────┤         ├─────────────────────┤                                                          │   │
│   │ PK id (UUID)        │◄────────┤ FK event_id         │                                                          │   │
│   │    title            │         │ FK user_id ─────────┼──────────────────────────────────────────────────────────┤   │
│   │    description      │         │    status           │  ← 'pending', 'accepted', 'declined'                     │   │
│   │    start_time       │         └─────────────────────┘                                                          │   │
│   │    end_time         │                                                                                          │   │
│   │    all_day          │                                                                                          │   │
│   │    color            │                                                                                          │   │
│   │    reminder_minutes │                                                                                          │   │
│   │ FK project_id       │                                                                                          │   │
│   │ FK task_id          │                                                                                          │   │
│   │ FK created_by ──────┼──────────────────────────────────────────────────────────────────────────────────────────┤   │
│   │    created_at       │                                                                                          │   │
│   └─────────────────────┘                                                                                          │   │
│                                                                                                                     │   │
│                                                                                                                     │   │
│   ┌─────────────────────┐         ┌─────────────────────┐                                                          │   │
│   │    notifications    │         │    activity_logs    │                                                          │   │
│   ├─────────────────────┤         ├─────────────────────┤                                                          │   │
│   │ PK id (UUID)        │         │ PK id               │                                                          │   │
│   │ FK user_id ─────────┼─────────┤ FK user_id ─────────┼──────────────────────────────────────────────────────────┘   │
│   │    type             │         │    action           │                                                              │
│   │    title            │         │    entity_type      │                                                              │
│   │    message          │         │    entity_id        │                                                              │
│   │    data (JSON)      │         │    details (JSON)   │                                                              │
│   │    is_read          │         │    ip_address       │                                                              │
│   │    created_at       │         │    created_at       │                                                              │
│   └─────────────────────┘         └─────────────────────┘                                                              │
│                                                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```


---

## 5. SƠ ĐỒ PHÂN QUYỀN (RBAC - Role-Based Access Control)

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                           RBAC PERMISSION SYSTEM                                                        │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                         │
│                                              USER ROLES HIERARCHY                                                       │
│                                                                                                                         │
│                                         ┌─────────────────────────┐                                                     │
│                                         │         ADMIN           │                                                     │
│                                         │                         │                                                     │
│                                         │  • Full system access   │                                                     │
│                                         │  • User management      │                                                     │
│                                         │  • System settings      │                                                     │
│                                         │  • View all data        │                                                     │
│                                         │  • Backup/Restore       │                                                     │
│                                         └───────────┬─────────────┘                                                     │
│                                                     │                                                                   │
│                                                     │ inherits                                                          │
│                                                     ▼                                                                   │
│                                         ┌─────────────────────────┐                                                     │
│                                         │        MANAGER          │                                                     │
│                                         │                         │                                                     │
│                                         │  • Team management      │                                                     │
│                                         │  • Project oversight    │                                                     │
│                                         │  • Reports & Analytics  │                                                     │
│                                         │  • Workload management  │                                                     │
│                                         └───────────┬─────────────┘                                                     │
│                                                     │                                                                   │
│                                                     │ inherits                                                          │
│                                                     ▼                                                                   │
│                                         ┌─────────────────────────┐                                                     │
│                                         │         MEMBER          │                                                     │
│                                         │                         │                                                     │
│                                         │  • Own projects/tasks   │                                                     │
│                                         │  • Assigned tasks       │                                                     │
│                                         │  • Documents access     │                                                     │
│                                         │  • Calendar events      │                                                     │
│                                         └─────────────────────────┘                                                     │
│                                                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                           PERMISSION MATRIX                                                             │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                         │
│   ┌─────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │     RESOURCE        │                              PERMISSIONS BY ROLE                                            │ │
│   ├─────────────────────┼───────────────────┬───────────────────┬───────────────────┬───────────────────────────────┤ │
│   │                     │      ADMIN        │      MANAGER      │      MEMBER       │         NOTES                 │ │
│   ├─────────────────────┼───────────────────┼───────────────────┼───────────────────┼───────────────────────────────┤ │
│   │ Users               │ CRUD + Activate   │ View team only    │ View self only    │ Admin can manage all users    │ │
│   ├─────────────────────┼───────────────────┼───────────────────┼───────────────────┼───────────────────────────────┤ │
│   │ Projects            │ CRUD all          │ CRUD team's       │ CRUD own + view   │ Member sees assigned projects │ │
│   │                     │                   │                   │ assigned          │                               │ │
│   ├─────────────────────┼───────────────────┼───────────────────┼───────────────────┼───────────────────────────────┤ │
│   │ Tasks               │ CRUD all          │ CRUD team's       │ CRUD own + update │ Member can update assigned    │ │
│   │                     │                   │                   │ assigned          │ task status                   │ │
│   ├─────────────────────┼───────────────────┼───────────────────┼───────────────────┼───────────────────────────────┤ │
│   │ Documents           │ CRUD all          │ CRUD team's       │ CRUD own + view   │ Based on project membership   │ │
│   │                     │                   │                   │ shared            │                               │ │
│   ├─────────────────────┼───────────────────┼───────────────────┼───────────────────┼───────────────────────────────┤ │
│   │ Calendar            │ View all          │ View team's       │ CRUD own + view   │ Can see events invited to     │ │
│   │                     │                   │                   │ invited           │                               │ │
│   ├─────────────────────┼───────────────────┼───────────────────┼───────────────────┼───────────────────────────────┤ │
│   │ Reports             │ All reports       │ Team reports      │ Personal reports  │ Scope based on role           │ │
│   ├─────────────────────┼───────────────────┼───────────────────┼───────────────────┼───────────────────────────────┤ │
│   │ Admin Panel         │ Full access       │ No access         │ No access         │ Admin only                    │ │
│   ├─────────────────────┼───────────────────┼───────────────────┼───────────────────┼───────────────────────────────┤ │
│   │ System Settings     │ Full access       │ No access         │ No access         │ Admin only                    │ │
│   ├─────────────────────┼───────────────────┼───────────────────┼───────────────────┼───────────────────────────────┤ │
│   │ Activity Logs       │ View all          │ View team's       │ View own          │ Audit trail                   │ │
│   └─────────────────────┴───────────────────┴───────────────────┴───────────────────┴───────────────────────────────┘ │
│                                                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```


---

## 6. SƠ ĐỒ LUỒNG XÁC THỰC (AUTHENTICATION FLOW)

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                           AUTHENTICATION FLOW                                                           │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                         │
│                                              LOGIN FLOW                                                                 │
│                                                                                                                         │
│   ┌─────────────┐         ┌─────────────┐         ┌─────────────┐         ┌─────────────┐         ┌─────────────┐      │
│   │   Browser   │         │  login.php  │         │AuthController│        │  User Model │         │   Session   │      │
│   └──────┬──────┘         └──────┬──────┘         └──────┬──────┘         └──────┬──────┘         └──────┬──────┘      │
│          │                       │                       │                       │                       │             │
│          │  1. GET /login.php    │                       │                       │                       │             │
│          │──────────────────────►│                       │                       │                       │             │
│          │                       │                       │                       │                       │             │
│          │  2. Return login form │                       │                       │                       │             │
│          │◄──────────────────────│                       │                       │                       │             │
│          │                       │                       │                       │                       │             │
│          │  3. POST email/password                       │                       │                       │             │
│          │──────────────────────►│                       │                       │                       │             │
│          │                       │                       │                       │                       │             │
│          │                       │  4. login($email, $password)                  │                       │             │
│          │                       │──────────────────────►│                       │                       │             │
│          │                       │                       │                       │                       │             │
│          │                       │                       │  5. findByEmail($email)                       │             │
│          │                       │                       │──────────────────────►│                       │             │
│          │                       │                       │                       │                       │             │
│          │                       │                       │  6. Return user data  │                       │             │
│          │                       │                       │◄──────────────────────│                       │             │
│          │                       │                       │                       │                       │             │
│          │                       │                       │  7. password_verify() │                       │             │
│          │                       │                       │─────────┐             │                       │             │
│          │                       │                       │         │             │                       │             │
│          │                       │                       │◄────────┘             │                       │             │
│          │                       │                       │                       │                       │             │
│          │                       │                       │  8. Session::set('user_id', $id)              │             │
│          │                       │                       │──────────────────────────────────────────────►│             │
│          │                       │                       │                       │                       │             │
│          │                       │  9. redirect('/index.php')                    │                       │             │
│          │                       │◄──────────────────────│                       │                       │             │
│          │                       │                       │                       │                       │             │
│          │  10. 302 Redirect     │                       │                       │                       │             │
│          │◄──────────────────────│                       │                       │                       │             │
│          │                       │                       │                       │                       │             │
│          │  11. GET /index.php (with session cookie)     │                       │                       │             │
│          │──────────────────────────────────────────────────────────────────────────────────────────────►│             │
│          │                       │                       │                       │                       │             │
│                                                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                         │
│                                         SESSION-BASED AUTHENTICATION                                                    │
│                                                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                                                 │  │
│   │   1. User logs in successfully                                                                                  │  │
│   │      └── Session::set('user_id', $userId)                                                                       │  │
│   │      └── Session::set('user_role', $role)                                                                       │  │
│   │      └── Session::set('user_name', $fullName)                                                                   │  │
│   │                                                                                                                 │  │
│   │   2. PHP generates session ID (PHPSESSID cookie)                                                                │  │
│   │      └── Cookie: PHPSESSID=abc123xyz...                                                                         │  │
│   │      └── HttpOnly, Secure, SameSite=Strict                                                                      │  │
│   │                                                                                                                 │  │
│   │   3. Session data stored server-side                                                                            │  │
│   │      └── /tmp/sess_abc123xyz... (or configured path)                                                            │  │
│   │                                                                                                                 │  │
│   │   4. Subsequent requests                                                                                        │  │
│   │      └── Browser sends PHPSESSID cookie                                                                         │  │
│   │      └── PHP loads session data                                                                                 │  │
│   │      └── AuthMiddleware checks Session::has('user_id')                                                          │  │
│   │                                                                                                                 │  │
│   │   5. Logout                                                                                                     │  │
│   │      └── Session::destroy()                                                                                     │  │
│   │      └── Cookie cleared                                                                                         │  │
│   │                                                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```


---

## 7. SƠ ĐỒ API ENDPOINTS

```
┌───────────────────────────────────────────